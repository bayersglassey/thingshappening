{% extends "base.html" %}

{% block js %}
{{ block.super }}
<script>
    var TVGuide = window.TVGuide;
    $(document).ready(function(){

        /* Get important DOM elements */
        var main = document.getElementById('main');
        var clear_btn = document.getElementById('clear_btn');
        var generate_20_btn = document.getElementById('generate_20_btn');

        /* The TVGuide and events data */
        var tvguide = new TVGuide();
        var view = tvguide.get_simple_view();
        var view_elem = null;
        create_random_events(50);


        /********************
         * Widget functions *
         ********************/

        function create_random_events(n){
            var events_data = TVGuide.Event.random_events_data(40);
            tvguide.add_events(events_data);
            render();
        }
        function clear_events(){
            tvguide.clear();
            render();
        }
        function crop_events(){
            var x = view_elem.scrollLeft;
            var w = view_elem.clientWidth;
            var x_time = view.get_x_time(x);
            var w_ms = view.get_w_ms(w);
            tvguide.crop(x_time, w_ms);
            render();
        }
        function render(){
            if(view_elem)view_elem.remove();
            view_elem = view.render();
            main.append(view_elem);
        }


        /*******************
         * Event listeners *
         *******************/

        clear_btn.onclick = function(event){
            clear_events();
        }
        crop_btn.onclick = function(event){
            crop_events();
        }
        generate_20_btn.onclick = function(event){
            create_random_events(20);
        }

    });
</script>
{% endblock %}

{% block main %}
    <style>
        #main {
            width: 100%;
            height: 20em;
        }
    </style>
    <div class="panel panel-default">
        <div class="panel-body">
            <div id="main">
            </div>
            <div>
                <button id="clear_btn">Clear events</button>
                <br>
                <button id="crop_btn">Crop events</button>
                <br>
                <button id="generate_20_btn">Generate 20 new events</button>
            </div>
        </div>
    </div>
{% endblock %}
